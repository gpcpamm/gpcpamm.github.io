"use strict";(self["webpackChunkGPCPAMM"]=self["webpackChunkGPCPAMM"]||[]).push([[971],{166:function(e,t,a){e.exports=a.p+"static/img/menu2-selected.887cd0f0.png"},829:function(e,t,a){e.exports=a.p+"static/img/menu1.c412536c.png"},1971:function(e,t,a){a.r(t),a.d(t,{default:function(){return E}});a(4114),a(8111),a(1701);var n=a(641),o=a(33),l=a(3751),s=a(953),r=a(7043),c=a(998),i=a(7891),u=a(8193),d=a(31),v=a(2141);const p={class:"home"},f={class:"fixed-head"},g={class:"app-head"},m={class:"title"},h={key:0,class:"main"},k={class:"project"},b={class:"content"},y=["onClick"],w={class:"top"},L={class:"pj-logo left"},C=["src"],x={class:"right"},T={class:"middle"},K={class:"bottom ft13"},M={class:"text fl"},S=["onClick"];var _={__name:"index",setup(e){var t=a(5093);const _=(0,r.rd)(),j=(0,s.KR)(""),A=(0,s.KR)(!1),E=(0,s.KR)(0),R=(0,s.KR)("PAMM"),P=(0,s.KR)(0),D=(0,s.KR)(null),$=(0,s.KR)(null),Y=(0,s.KR)(null),F=(0,s.KR)(0),G=(0,s.KR)([]),V=(0,s.KR)(!1),W=(0,s.KR)(!1),H=(0,s.KR)(!1),O=(0,s.Kh)({height:"auto"}),X=(0,s.Kh)(i.n),q=((0,s.KR)([{src:a(4751)},{src:a(7062)}]),(0,n.EW)(()=>Object.entries(u.J).map(([e,t])=>({value:Number(e),label:t.text}))));(0,n.EW)(()=>{const e=100;return`calc(100vh - ${e}px)`});(0,n.wB)(E,(e,t)=>{}),(0,n.wB)(P,e=>{R.value=4===e?"我的参与":"PAMM"}),(0,n.sV)(async()=>{await B(),await I(),await Q(),oe(0,q.value[0].value),(0,n.dY)(()=>{setTimeout(()=>{se(),window.addEventListener("resize",se)},100)})}),(0,n.xo)(()=>{window.removeEventListener("resize",se)});const B=async()=>{if(Y.value){const e=await Y.value.getWalletState();e.isConnected?j.value=e.account:await N()}},I=async()=>{const e=j.value,t=d.b(e),a=d.b(i.n.contracts[0].address);let n=await Y.value.readContract("gpc","allowance",[t,a]);F.value=n},z=e=>{_.push({path:"/project-detail",query:{id:e}})},J=async e=>{const t=j.value,a=d.b(t),n=d.b(i.n.contracts[0].address);let o=await Y.value.readContract("gpc","allowance",[a,n]);F.value=o,o>0||await Y.value.writeContract("gpc","approve",[n,v.g5("123456789012345678901234567890")]),_.push({path:"/project-detail",query:{id:e}})},N=async()=>{A.value=!0;try{if(Y.value){const e=await Y.value.connectWallet();j.value=e}}catch(e){console.error("连接钱包失败：",e)}finally{A.value=!1}},U=e=>{let a=t(1e3*e.toString()).diff(t(),"seconds");a=Math.max(a,0);const n=Math.floor(a/86400);let o=a%86400;const l=Math.floor(o/3600);o%=3600;const s=Math.floor(o/60),r=o%60;let c="";return n>0&&(c+=`${n}天`),(l>0||c)&&(c+=`${l}小时`),(s>0||c)&&(c+=`${s}分钟`),c+=`${r}秒`,console.log(`剩余时间：${c}`),c},Q=async()=>{try{if(Y.value){const e=await Y.value.readContract("gpcPamm","getPrammTokens");for(let a=0;a<e.length;a++){console.log(e[a]);let n=t(1e3*e[a][28].toString()).format("YYYY-MM-DD HH:mm:ss"),o=t(1e3*e[a][29].toString()).format("YYYY-MM-DD HH:mm:ss"),l=e[a][30],s=0,r="",c="";l||1e3*e[a][29].toString()<(new Date).getTime()?s=3:parseInt(1e3*e[a][28].toString())<(new Date).getTime()?(s=1,c=U(e[a][29]),console.log(c)):1e3*e[a][28].toString()>(new Date).getTime()&&(s=2,console.log(1e3*e[a][28].toString(),(new Date).getTime()),r=U(e[a][28]));const i=u.J[s]||u.K;console.log(n,o,l,s);let d={pjStatus:s,symbol:e[a][3],name:e[a][2],desc:e[a][5],timeToStart:r,timeToEnd:c,startTime:n,endTime:o,logo:e[a][4],joinFlag:!0,pjStatusText:i.text,iconColor:i.bgColor,btnAction:i.btnAction,timePrefix:i.timePrefix};console.log(d),0==F.value&&2===s?d.btnAction="预约":2==s&&(d.btnAction="详情"),G.value.push(d)}}}catch(e){console.log(e)}},Z=e=>{j.value=e.account},ee=({key:e,contract:t})=>{console.log(e,"合约初始化成功：",t.target)},te=({contractKey:e,methodName:t,receipt:a})=>{console.log(`交易成功：${t}`,a)},ae=({scene:e,error:t})=>{console.error(`区块链错误[${e}]：`,t)},ne=e=>e?`${e.slice(0,6)}...${e.slice(-4)}`:"",oe=(e,t)=>{P.value=e,D.value=t},le=()=>{j.value.toLowerCase()=="0x85Dfe8fac750d08393dC02Df35E3b2D5BFC0C667".toLowerCase()&&_.push({path:"/application"})},se=()=>{const e=document.querySelector(".fixed-head");if(e&&$.value){const t=e.offsetHeight;O.height=`calc(100vh - ${t}px)`}};return(e,t)=>{const s=(0,n.g2)("van-list"),r=(0,n.g2)("van-pull-refresh");return(0,n.uX)(),(0,n.CE)("div",p,[(0,n.Lk)("div",f,[(0,n.Lk)("div",g,[(0,n.Lk)("span",{class:"head-left",onClick:N},(0,o.v_)(j.value?ne(j.value):"连接钱包"),1),(0,n.Lk)("span",m,(0,o.v_)(R.value),1),(0,n.bo)((0,n.Lk)("span",{class:"head-right",onClick:le},[...t[2]||(t[2]=[(0,n.eW)(" 我的PAMM ",-1),(0,n.Lk)("i",{class:"el-icon-arrow-right"},null,-1)])],512),[[l.aG,!E.value]])]),0===E.value?((0,n.uX)(),(0,n.CE)("div",h,[...t[3]||(t[3]=[(0,n.Lk)("div",{class:"left"},null,-1)])])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",{class:"list",ref_key:"myList",ref:$,style:(0,o.Tr)(O)},[(0,n.Lk)("div",k,[(0,n.Lk)("div",b,[(0,n.bF)(r,{modelValue:H.value,"onUpdate:modelValue":t[1]||(t[1]=e=>H.value=e)},{default:(0,n.k6)(()=>[(0,n.bF)(s,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=e=>V.value=e),finished:W.value,"loading-text":"加载中...","finished-text":"没有更多了",onLoad:e.onLoad},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(G.value,(e,s)=>((0,n.uX)(),(0,n.CE)("div",{class:"box",key:s,onClick:e=>z(s)},[(0,n.Lk)("div",w,[(0,n.Lk)("span",{class:"absolute",style:(0,o.Tr)({backgroundColor:e.iconColor})},[(0,n.Lk)("span",null,(0,o.v_)(e.pjStatusText),1)],4),(0,n.Lk)("div",L,[(0,n.Lk)("img",{src:e.logo?e.logo:a(1169),alt:""},null,8,C)]),(0,n.Lk)("div",x,[(0,n.Lk)("p",null,(0,o.v_)(e.symbol),1),(0,n.Lk)("p",null,(0,o.v_)(e.name),1)])]),(0,n.Lk)("div",T,[t[4]||(t[4]=(0,n.Lk)("p",{class:"ft15"},"项目简介：",-1)),(0,n.Lk)("p",null,(0,o.v_)(e.desc),1)]),(0,n.Lk)("div",K,[(0,n.Lk)("div",null,[(0,n.Lk)("span",M,(0,o.v_)(e.timePrefix),1),(0,n.bo)((0,n.Lk)("span",{class:"time fl"},(0,o.v_)(e.timeToEnd),513),[[l.aG,1===e.pjStatus]]),(0,n.bo)((0,n.Lk)("span",{class:"time fl"},(0,o.v_)(e.timeToStart),513),[[l.aG,2===e.pjStatus]]),(0,n.bo)((0,n.Lk)("span",{class:"time fl"},(0,o.v_)(e.endTime),513),[[l.aG,3===e.pjStatus]]),(0,n.bo)((0,n.Lk)("div",{class:"btn fr linear-gradient-blue",onClick:(0,l.D$)(e=>J(s),["stop"])},(0,o.v_)(e.btnAction),9,S),[[l.aG,!(3===e.pjStatus&&!e.joinFlag)]])])])],8,y))),128))]),_:1},8,["modelValue","finished","onLoad"])]),_:1},8,["modelValue"])])]),(0,n.bF)(c.A,{ref_key:"blockchainRef",ref:Y,config:X,onWalletConnected:Z,onContractReady:ee,onTxSuccess:te,onError:ae},null,8,["config"])],4)])}}},j=a(6262);const A=(0,j.A)(_,[["__scopeId","data-v-27e3387f"]]);var E=A},4114:function(e,t,a){var n=a(6518),o=a(8981),l=a(6198),s=a(4527),r=a(6837),c=a(9039),i=c(function(){return 4294967297!==[].push.call({length:4294967296},1)}),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},d=i||!u();n({target:"Array",proto:!0,arity:1,forced:d},{push:function(e){var t=o(this),a=l(t),n=arguments.length;r(a+n);for(var c=0;c<n;c++)t[a]=arguments[c],a++;return s(t,a),a}})},4376:function(e,t,a){var n=a(2195);e.exports=Array.isArray||function(e){return"Array"===n(e)}},4527:function(e,t,a){var n=a(3724),o=a(4376),l=TypeError,s=Object.getOwnPropertyDescriptor,r=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=r?function(e,t){if(o(e)&&!s(e,"length").writable)throw new l("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},4751:function(e,t,a){e.exports=a.p+"static/img/menu1-selected.7d37f964.png"},6837:function(e){var t=TypeError,a=9007199254740991;e.exports=function(e){if(e>a)throw t("Maximum allowed index exceeded");return e}},7062:function(e,t,a){e.exports=a.p+"static/img/menu2.e8fedcb5.png"}}]);