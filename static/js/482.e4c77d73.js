"use strict";(self["webpackChunkGPCPAMM"]=self["webpackChunkGPCPAMM"]||[]).push([[482],{1482:function(e,l,a){a.r(l),a.d(l,{default:function(){return N}});a(8111),a(7588);var o=a(641),s=a(953),t=a(3751),n=a(33),u=a(2141),i=a(31),d=a(7043),c=a(998),r=a(3326),m=a(4335),p=a(7891);const v={class:"application ft14"},f={class:"app-head"},b={class:"head-left"},k={class:"content"},g={class:"pamm-info base_box_shadow"},V={class:"upload-name-row"},y={class:"uploader-container"},h={class:"name-container"},w={class:"inline-field"},U={class:"inline-field"},L={class:"inline-field"},C={class:"inline-field"},x={class:"inline-field"},F={class:"suffix-field"},M={class:"inline-field"},R={class:"inline-field"},T={class:"inline-field"},I={class:"application-amount"},W="https://lavender-absent-booby-253.mypinata.cloud",P="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiIwZWNmZWVlNC1kNzE4LTQ4MTMtOWU3NS00YzJkOWMwZGZjOWEiLCJlbWFpbCI6ImdvbGRwYW1tY29pbkBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwicGluX3BvbGljeSI6eyJyZWdpb25zIjpbeyJkZXNpcmVkUmVwbGljYXRpb25Db3VudCI6MSwiaWQiOiJGUkExIn0seyJkZXNpcmVkUmVwbGljYXRpb25Db3VudCI6MSwiaWQiOiJOWUMxIn1dLCJ2ZXJzaW9uIjoxfSwibWZhX2VuYWJsZWQiOmZhbHNlLCJzdGF0dXMiOiJBQ1RJVkUifSwiYXV0aGVudGljYXRpb25UeXBlIjoic2NvcGVkS2V5Iiwic2NvcGVkS2V5S2V5IjoiZjE3MGRhNGEzMTI0NDM4MzUyZmYiLCJzY29wZWRLZXlTZWNyZXQiOiIyMzM4Y2NmZTU4YWMxMTc4OGIxNjE0OWMwNTU4ZDQ0MDkwMzFhZmFmZGNhYjNiNWIxNDI3MmQyZGM5MGIzMjU2IiwiZXhwIjoxNzkwNzI5OTIyfQ.4PHrlidztReaowkVrrLE6WmQwoEOfTsUroCNA2tZVuQ";var Z={__name:"index",setup(e){const l=(0,d.rd)(),a=(0,s.Kh)(p.n),Z=(0,s.KR)(!1),G=(0,s.KR)([]),K=(0,s.KR)(10485760),N=new Date,J=["year","month","day"],z=["hour","minute","second"],D=(0,s.KR)([N.getFullYear(),N.getMonth()+1,N.getDate()]),S=(0,s.KR)([N.getHours(),N.getMinutes(),N.getSeconds()]),j=(0,s.KR)([N.getFullYear(),N.getMonth()+1,N.getDate()]),O=(0,s.KR)([N.getHours(),N.getMinutes(),N.getSeconds()]),X=(e,l)=>("hour"===e&&(l.text+=":"),"minute"===e&&(l.text+=":"),l),_=(0,s.Kh)({name:"",symbol:"",logo:"",desc:"",totalSupply:"",initUsdt:1e4,daoPerUsdt:"",daoTotal:"",commonTimes:"250",commonMaxPerUsdt:"",commonTotal:"",startTime:"",endTime:""}),Y=(0,s.KR)(0),A=(0,s.KR)(0),q=(0,s.KR)("100000"),E=((0,s.KR)("10000"),(0,s.KR)("地址")),Q=(0,s.KR)(!1),$=(0,s.KR)(!1),B=(0,s.KR)(0),H=(0,s.KR)(!1),ee=(0,s.KR)(!1),le=(0,s.KR)(null),ae=(0,s.KR)(null),oe=(0,s.KR)(""),se=(0,s.KR)(!1),te=(0,s.KR)(0),ne=(0,s.KR)(0);(0,o.sV)(async()=>{await ce(),await me(),await pe()});const ue=e=>{let l=te.value;console.log(l),B.value=(e/l).toFixed(4)},ie=e=>{_.daoTotal=e*(ne.value/q.value)+parseFloat(_.initUsdt),_.commonTotal=_.daoTotal*_.commonTimes/100},de=()=>!1,ce=async()=>{if(ae.value){const e=await ae.value.getWalletState();e.isConnected?oe.value=e.account:await re()}},re=async()=>{se.value=!0;try{if(ae.value){const e=await ae.value.connectWallet();oe.value=e}}catch(e){console.error("连接钱包失败：",e)}finally{se.value=!1}},me=async()=>{try{if(ae.value){const e=await ae.value.readContract("gpcPamm","gpcPrice");te.value=u.ck(e),console.log(te.value),B.value=(_.initUsdt/te.value).toFixed(4)}}catch(e){console.error("获取价格失败",e)}},pe=async()=>{try{if(ae.value){const e=await ae.value.readContract("gpcDao","getTotalDAO");ne.value=u.ck(e),console.log("totalDao",e)}}catch(e){console.error("连接钱包失败：",e)}},ve=e=>{oe.value=e.account},fe=({key:e,contract:l})=>{console.log(e,"合约初始化成功：",l.target)},be=({contractKey:e,methodName:l,receipt:a})=>{console.log(`交易成功：${l}`,a)},ke=({scene:e,error:l})=>{console.error(`区块链错误[${e}]：`,l)},ge=async()=>{if(Y.value=parseInt(Date.parse(_.startTime)/1e3),A.value=parseInt(Date.parse(_.endTime)/1e3),console.log(Y.value,A.value),Y.value>A.value)return void(0,r.P0)("结束时间必须在开始时间之后");if(!_.logo)return(0,r.P0)("请上传logo图"),void(Z.value=!0);const e=oe.value,l=i.b(e),a=i.b(p.n.contracts[0].address);console.log("验证通过，提交数据"),H.value=!0;try{let e=await ae.value.readContract("gpc","allowance",[l,a]);parseFloat(e)<parseFloat(B.value)&&(console.log("需要授权",e,B.value),await ae.value.writeContract("gpc","approve",[a,u.g5("123456789012345678901234567890")])),await ae.value.writeContract("gpcPamm","addTokenTemp",[_.name,_.symbol,_.logo,_.desc,_.totalSupply,_.initUsdt,_.daoPerUsdt,_.commonTimes,_.commonMaxPerUsdt,Y.value,A.value])}catch(o){console.log(o)}H.value=!1},Ve=()=>{_.startTime=`${D.value.join("-")} ${S.value.join(":")}`,Q.value=!1},ye=()=>{_.endTime=`${j.value.join("-")} ${O.value.join(":")}`,$.value=!1},he=e=>{Array.isArray(e)?e.forEach(e=>we(e)):we(e)},we=e=>{console.log(e),e.status="uploading",e.message="上传中...";const l=new FormData;l.append("file",e.file),l.append("network","public"),m.A.post("https://uploads.pinata.cloud/v3/files",l,{headers:{Authorization:`Bearer ${P}`}}).then(l=>{console.log(l.data);const a=l.data.data.cid;if(!a)throw new Error("Pinata未返回有效CID");const o=`${W}/ipfs/${a}`;_.logo=o,e.status="done",e.url=o}).catch(l=>{console.log(l),e.status="failed",e.message="上传失败"})},Ue=e=>{(0,r.P0)(`图片大小不能超过 ${K.value/1024/1024}MB`)},Le=e=>{G.value.splice(e,1),Z.value=!0,_.logoUrl="",(0,r.P0)("图片已删除")};return(e,u)=>{const i=(0,o.g2)("van-uploader"),d=(0,o.g2)("van-field"),r=(0,o.g2)("van-date-picker"),m=(0,o.g2)("van-time-picker"),p=(0,o.g2)("van-picker-group"),W=(0,o.g2)("van-popup"),P=(0,o.g2)("van-form"),N=(0,o.g2)("van-button");return(0,o.uX)(),(0,o.CE)("div",v,[(0,o.Lk)("div",f,[(0,o.Lk)("span",b,[(0,o.Lk)("i",{class:"el-icon-arrow-left",onClick:u[0]||(u[0]=e=>(0,s.R1)(l).go(-1))})]),u[23]||(u[23]=(0,o.Lk)("span",{class:"title"},"我的PAMM",-1))]),(0,o.Lk)("div",k,[(0,o.Lk)("div",g,[(0,o.bF)(P,{ref_key:"formRef",ref:le,onSubmit:(0,t.D$)(de,["prevent"]),required:""},{default:(0,o.k6)(()=>[(0,o.Lk)("div",V,[(0,o.Lk)("div",y,[(0,o.bF)(i,{modelValue:G.value,"onUpdate:modelValue":u[1]||(u[1]=e=>G.value=e),"after-read":he,class:(0,n.C4)({"field-error":ee.value}),deletable:!0,"max-size":K.value,onOversize:Ue,"preview-image":!0,onDelete:Le,"max-count":1,rules:[{required:!0,message:"请上传图片"}]},{default:(0,o.k6)(()=>[(0,o.Lk)("div",{class:(0,n.C4)(["upload-area","ft12",{"error-uploader":Z.value}])},[...u[24]||(u[24]=[(0,o.Lk)("p",null,"+",-1),(0,o.Lk)("p",null,"Logo点击上传",-1)])],2)]),_:1},8,["modelValue","class","max-size"])]),(0,o.Lk)("div",h,[(0,o.bF)(d,{modelValue:_.name,"onUpdate:modelValue":u[2]||(u[2]=e=>_.name=e),placeholder:"项目全称,如GoldPammCoin",class:"custom-field",rules:[{required:!0,message:"请输入项目全称"}]},null,8,["modelValue"]),(0,o.bF)(d,{modelValue:_.symbol,"onUpdate:modelValue":u[3]||(u[3]=e=>_.symbol=e),placeholder:"项目简称,如GPC",class:"custom-field",rules:[{required:!0,message:"请输入项目简称"}]},null,8,["modelValue"])])]),u[41]||(u[41]=(0,o.Lk)("p",{class:"label-title"},"项目简介",-1)),(0,o.bF)(d,{modelValue:_.desc,"onUpdate:modelValue":u[4]||(u[4]=e=>_.desc=e),type:"textarea",placeholder:"请输入内容",rows:"3",autosize:"",rules:[{required:!0,message:"请输入项目简介"}],class:"custom-field"},null,8,["modelValue"]),(0,o.Lk)("div",w,[u[25]||(u[25]=(0,o.Lk)("span",{class:"prefix-label"},"总发行数量",-1)),(0,o.bF)(d,{modelValue:_.totalSupply,"onUpdate:modelValue":u[5]||(u[5]=e=>_.totalSupply=e),type:"number",placeholder:"",class:"custom-field",rules:[{required:!0,message:"请输入数值"}]},null,8,["modelValue"]),u[26]||(u[26]=(0,o.Lk)("span",{class:"suffix-field"},"枚",-1))]),(0,o.Lk)("div",U,[u[27]||(u[27]=(0,o.Lk)("span",{class:"prefix-label"},"初始投入",-1)),(0,o.bF)(d,{modelValue:_.initUsdt,"onUpdate:modelValue":[u[6]||(u[6]=e=>_.initUsdt=e),ue],type:"number",placeholder:"",class:"custom-field",rules:[{required:!0,message:"请输入数值"}]},null,8,["modelValue"]),u[28]||(u[28]=(0,o.Lk)("span",{class:"suffix-field"},"U",-1))]),(0,o.Lk)("div",L,[u[29]||(u[29]=(0,o.Lk)("span",{class:"prefix-label"},"GPCDAO打新",-1)),(0,o.bF)(d,{"onUpdate:modelValue":[ie,u[7]||(u[7]=e=>_.daoPerUsdt=e)],modelValue:_.daoPerUsdt,type:"number",placeholder:"",class:"custom-field",rules:[{required:!0,message:"请输入数值"}]},null,8,["modelValue"]),u[30]||(u[30]=(0,o.Lk)("span",{class:"suffix-field"},"U/10万GPC",-1))]),(0,o.Lk)("div",C,[u[31]||(u[31]=(0,o.Lk)("span",{class:"prefix-label"},"预计可打新",-1)),(0,o.bF)(d,{modelValue:_.daoTotal,"onUpdate:modelValue":u[8]||(u[8]=e=>_.daoTotal=e),type:"number",readonly:"",placeholder:"",class:"custom-field"},null,8,["modelValue"]),u[32]||(u[32]=(0,o.Lk)("span",{class:"suffix-field"},"U",-1))]),(0,o.Lk)("div",x,[u[33]||(u[33]=(0,o.Lk)("span",{class:"prefix-label"},"GPC矿工打新",-1)),(0,o.bF)(d,{modelValue:_.commonMaxPerUsdt,"onUpdate:modelValue":u[9]||(u[9]=e=>_.commonMaxPerUsdt=e),type:"number",placeholder:"",class:"custom-field",rules:[{required:!0,message:"请输入数值"}]},null,8,["modelValue"]),(0,o.Lk)("span",F,"U/"+(0,n.v_)(E.value),1)]),(0,o.Lk)("div",M,[u[34]||(u[34]=(0,o.Lk)("span",{class:"prefix-label"},"预计可打新",-1)),(0,o.bF)(d,{modelValue:_.commonTotal,"onUpdate:modelValue":u[10]||(u[10]=e=>_.commonTotal=e),type:"number",readonly:"",placeholder:"",class:"custom-field","error-message":"请输入数值",rules:[{required:!0,message:"请输入数值"}]},null,8,["modelValue"]),u[35]||(u[35]=(0,o.Lk)("span",{class:"suffix-field"},"U",-1))]),(0,o.Lk)("div",R,[u[36]||(u[36]=(0,o.Lk)("span",{class:"prefix-label time"},"开始时间",-1)),(0,o.bF)(d,{readonly:"",clickable:"",modelValue:_.startTime,"onUpdate:modelValue":u[11]||(u[11]=e=>_.startTime=e),class:"custom-field",placeholder:"选择开始时间,项目开启打新",rules:[{required:!0,message:"请选择开始时间"}],onClick:u[12]||(u[12]=e=>Q.value=!0)},null,8,["modelValue"]),u[37]||(u[37]=(0,o.Lk)("span",{class:"suffix-field"},null,-1)),(0,o.bF)(W,{show:Q.value,"onUpdate:show":u[16]||(u[16]=e=>Q.value=e),position:"bottom"},{default:(0,o.k6)(()=>[(0,o.bF)(p,{title:"开始时间",tabs:["选择日期","选择时间"],onConfirm:Ve,onCancel:u[15]||(u[15]=e=>Q.value=!1)},{default:(0,o.k6)(()=>[(0,o.bF)(r,{modelValue:D.value,"onUpdate:modelValue":u[13]||(u[13]=e=>D.value=e),"columns-type":J},null,8,["modelValue"]),(0,o.bF)(m,{modelValue:S.value,"onUpdate:modelValue":u[14]||(u[14]=e=>S.value=e),formatter:X,"columns-type":z},null,8,["modelValue"])]),_:1})]),_:1},8,["show"])]),(0,o.Lk)("div",T,[u[38]||(u[38]=(0,o.Lk)("span",{class:"prefix-label time"},"结束时间",-1)),(0,o.bF)(d,{readonly:"",clickable:"",modelValue:_.endTime,"onUpdate:modelValue":u[17]||(u[17]=e=>_.endTime=e),class:"custom-field",placeholder:"结束时间,结束后项目立即上线",rules:[{required:!0,message:"请选择结束时间"}],onClick:u[18]||(u[18]=e=>$.value=!0)},null,8,["modelValue"]),u[39]||(u[39]=(0,o.Lk)("span",{class:"suffix-field"},null,-1)),(0,o.bF)(W,{show:$.value,"onUpdate:show":u[22]||(u[22]=e=>$.value=e),position:"bottom"},{default:(0,o.k6)(()=>[(0,o.bF)(p,{title:"结束时间",tabs:["选择日期","选择时间"],onConfirm:ye,onCancel:u[21]||(u[21]=e=>$.value=!1)},{default:(0,o.k6)(()=>[(0,o.bF)(r,{modelValue:j.value,"onUpdate:modelValue":u[19]||(u[19]=e=>j.value=e),"columns-type":J},null,8,["modelValue"]),(0,o.bF)(m,{modelValue:O.value,"onUpdate:modelValue":u[20]||(u[20]=e=>O.value=e),formatter:X,"columns-type":z},null,8,["modelValue"])]),_:1})]),_:1},8,["show"])]),(0,o.Lk)("div",I,[u[40]||(u[40]=(0,o.eW)(" 申请费用： ",-1)),(0,o.Lk)("span",null,(0,n.v_)(B.value)+" GPC",1)])]),_:1},512),(0,o.Lk)("div",null,[(0,o.bF)(N,{color:"linear-gradient(45deg, #3567D5, #68A8F0)",style:{width:"200px",margin:"0 auto"},round:"",block:"",type:"info",loading:H.value,"loading-text":"提交中...",onClick:ge},{default:(0,o.k6)(()=>[...u[42]||(u[42]=[(0,o.eW)(" 提交申请 ",-1)])]),_:1},8,["loading"])])])]),(0,o.bF)(c.A,{ref_key:"blockchainRef",ref:ae,config:a,onWalletConnected:ve,onContractReady:fe,onTxSuccess:be,onError:ke},null,8,["config"])])}}},G=a(6262);const K=(0,G.A)(Z,[["__scopeId","data-v-20c23d6c"]]);var N=K}}]);