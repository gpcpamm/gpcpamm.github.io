"use strict";(self["webpackChunkGPCPAMM"]=self["webpackChunkGPCPAMM"]||[]).push([[903],{166:function(e,t,n){e.exports=n.p+"static/img/menu2-selected.887cd0f0.png"},829:function(e,t,n){e.exports=n.p+"static/img/menu1.c412536c.png"},1903:function(e,t,n){n.r(t),n.d(t,{default:function(){return R}});n(4114),n(8111),n(1701);var o=n(641),a=n(33),l=n(3751),s=n(953),r=n(7043),c=n(998),i=n(7891),u=n(8193);const d={class:"home"},f={class:"fixed-head"},v={class:"app-head"},p={class:"title"},g={key:0,class:"main"},m={class:"project"},h={class:"content"},k=["onClick"],y={class:"top"},L={class:"pj-logo left"},b=["src"],x={class:"right"},w={class:"middle"},C={class:"bottom ft13"},T={class:"text fl"},M=["onClick"];var S={__name:"index",setup(e){var t=n(5093);const S=(0,r.rd)(),_=(0,s.KR)(""),K=(0,s.KR)(!1),R=(0,s.KR)(0),j=(0,s.KR)("PAMM"),E=(0,s.KR)(0),P=(0,s.KR)(null),A=(0,s.KR)(null),D=(0,s.KR)(null),$=(0,s.KR)([]),Y=(0,s.KR)(!1),F=(0,s.KR)(!1),G=(0,s.KR)(!1),V=(0,s.Kh)({height:"auto"}),W=(0,s.Kh)(i.n),H=((0,s.KR)([{src:n(4751)},{src:n(7062)}]),(0,o.EW)(()=>Object.entries(u.J).map(([e,t])=>({value:Number(e),label:t.text}))));(0,o.EW)(()=>{const e=100;return`calc(100vh - ${e}px)`});(0,o.wB)(R,(e,t)=>{}),(0,o.wB)(E,e=>{j.value=4===e?"我的参与":"PAMM"}),(0,o.sV)(async()=>{await O(),await q(),Z(0,H.value[0].value),(0,o.dY)(()=>{setTimeout(()=>{te(),window.addEventListener("resize",te)},100)})}),(0,o.xo)(()=>{window.removeEventListener("resize",te)});const O=async()=>{if(D.value){const e=await D.value.getWalletState();e.isConnected?_.value=e.account:await B()}},X=e=>{S.push({path:"/project-detail",query:{id:e}})},B=async()=>{K.value=!0;try{if(D.value){const e=await D.value.connectWallet();_.value=e}}catch(e){console.error("连接钱包失败：",e)}finally{K.value=!1}},I=e=>{let n=t(1e3*e.toString()).diff(t(),"seconds");n=Math.max(n,0);const o=Math.floor(n/86400);let a=n%86400;const l=Math.floor(a/3600);a%=3600;const s=Math.floor(a/60),r=a%60;let c="";return o>0&&(c+=`${o}天`),(l>0||c)&&(c+=`${l}小时`),(s>0||c)&&(c+=`${s}分钟`),c+=`${r}秒`,console.log(`剩余时间：${c}`),c},q=async()=>{try{if(D.value){const e=await D.value.readContract("gpcPamm","getPrammTokens");for(let n=0;n<e.length;n++){console.log(e[n]);let o=t(1e3*e[n][28].toString()).format("YYYY-MM-DD HH:mm:ss"),a=t(1e3*e[n][29].toString()).format("YYYY-MM-DD HH:mm:ss"),l=e[n][30],s=0,r="",c="";l||1e3*e[n][29].toString()<(new Date).getTime()?s=3:parseInt(1e3*e[n][28].toString())<(new Date).getTime()?(s=1,c=I(e[n][29]),console.log(c)):1e3*e[n][28].toString()>(new Date).getTime()&&(s=2,console.log(1e3*e[n][28].toString(),(new Date).getTime()),r=I(e[n][28]));const i=u.J[s]||u.K;console.log(o,a,l,s);let d={pjStatus:s,symbol:e[n][3],name:e[n][2],desc:e[n][5],timeToStart:r,timeToEnd:c,startTime:o,endTime:a,logo:e[n][4],joinFlag:!0,pjStatusText:i.text,iconColor:i.bgColor,btnAction:i.btnAction,timePrefix:i.timePrefix};console.log(d),$.value.push(d)}}}catch(e){console.log(e)}},z=e=>{_.value=e.account},J=({key:e,contract:t})=>{console.log(e,"合约初始化成功：",t.target)},N=({contractKey:e,methodName:t,receipt:n})=>{console.log(`交易成功：${t}`,n)},U=({scene:e,error:t})=>{console.error(`区块链错误[${e}]：`,t)},Q=e=>e?`${e.slice(0,6)}...${e.slice(-4)}`:"",Z=(e,t)=>{E.value=e,P.value=t},ee=()=>{_.value.toLowerCase()=="0x85Dfe8fac750d08393dC02Df35E3b2D5BFC0C667".toLowerCase()&&S.push({path:"/application"})},te=()=>{const e=document.querySelector(".fixed-head");if(e&&A.value){const t=e.offsetHeight;V.height=`calc(100vh - ${t}px)`}};return(e,t)=>{const s=(0,o.g2)("van-list"),r=(0,o.g2)("van-pull-refresh");return(0,o.uX)(),(0,o.CE)("div",d,[(0,o.Lk)("div",f,[(0,o.Lk)("div",v,[(0,o.Lk)("span",{class:"head-left",onClick:B},(0,a.v_)(_.value?Q(_.value):"连接钱包"),1),(0,o.Lk)("span",p,(0,a.v_)(j.value),1),(0,o.bo)((0,o.Lk)("span",{class:"head-right",onClick:ee},[...t[2]||(t[2]=[(0,o.eW)(" 我的PAMM ",-1),(0,o.Lk)("i",{class:"el-icon-arrow-right"},null,-1)])],512),[[l.aG,!R.value]])]),0===R.value?((0,o.uX)(),(0,o.CE)("div",g,[...t[3]||(t[3]=[(0,o.Lk)("div",{class:"left"},null,-1)])])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",{class:"list",ref_key:"myList",ref:A,style:(0,a.Tr)(V)},[(0,o.Lk)("div",m,[(0,o.Lk)("div",h,[(0,o.bF)(r,{modelValue:G.value,"onUpdate:modelValue":t[1]||(t[1]=e=>G.value=e),onRefresh:e.onRefresh},{default:(0,o.k6)(()=>[(0,o.bF)(s,{modelValue:Y.value,"onUpdate:modelValue":t[0]||(t[0]=e=>Y.value=e),finished:F.value,"loading-text":"加载中...","finished-text":"没有更多了",onLoad:e.onLoad},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)($.value,(e,s)=>((0,o.uX)(),(0,o.CE)("div",{class:"box",key:s,onClick:e=>X(s)},[(0,o.Lk)("div",y,[(0,o.Lk)("span",{class:"absolute",style:(0,a.Tr)({backgroundColor:e.iconColor})},[(0,o.Lk)("span",null,(0,a.v_)(e.pjStatusText),1)],4),(0,o.Lk)("div",L,[(0,o.Lk)("img",{src:e.logo?e.logo:n(1169),alt:""},null,8,b)]),(0,o.Lk)("div",x,[(0,o.Lk)("p",null,(0,a.v_)(e.symbol),1),(0,o.Lk)("p",null,(0,a.v_)(e.name),1)])]),(0,o.Lk)("div",w,[t[4]||(t[4]=(0,o.Lk)("p",{class:"ft15"},"项目简介：",-1)),(0,o.Lk)("p",null,(0,a.v_)(e.desc),1)]),(0,o.Lk)("div",C,[(0,o.Lk)("div",null,[(0,o.Lk)("span",T,(0,a.v_)(e.timePrefix),1),(0,o.bo)((0,o.Lk)("span",{class:"time fl"},(0,a.v_)(e.timeToEnd),513),[[l.aG,1===e.pjStatus]]),(0,o.bo)((0,o.Lk)("span",{class:"time fl"},(0,a.v_)(e.timeToStart),513),[[l.aG,2===e.pjStatus]]),(0,o.bo)((0,o.Lk)("span",{class:"time fl"},(0,a.v_)(e.endTime),513),[[l.aG,3===e.pjStatus]]),(0,o.bo)((0,o.Lk)("div",{class:"btn fr linear-gradient-blue",onClick:(0,l.D$)(e=>X(s),["stop"])},(0,a.v_)(e.btnAction),9,M),[[l.aG,!(3===e.pjStatus&&!e.joinFlag)]])])])],8,k))),128))]),_:1},8,["modelValue","finished","onLoad"])]),_:1},8,["modelValue","onRefresh"])])]),(0,o.bF)(c.A,{ref_key:"blockchainRef",ref:D,config:W,onWalletConnected:z,onContractReady:J,onTxSuccess:N,onError:U},null,8,["config"])],4)])}}},_=n(6262);const K=(0,_.A)(S,[["__scopeId","data-v-0ebf69d8"]]);var R=K},4114:function(e,t,n){var o=n(6518),a=n(8981),l=n(6198),s=n(4527),r=n(6837),c=n(9039),i=c(function(){return 4294967297!==[].push.call({length:4294967296},1)}),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},d=i||!u();o({target:"Array",proto:!0,arity:1,forced:d},{push:function(e){var t=a(this),n=l(t),o=arguments.length;r(n+o);for(var c=0;c<o;c++)t[n]=arguments[c],n++;return s(t,n),n}})},4376:function(e,t,n){var o=n(2195);e.exports=Array.isArray||function(e){return"Array"===o(e)}},4527:function(e,t,n){var o=n(3724),a=n(4376),l=TypeError,s=Object.getOwnPropertyDescriptor,r=o&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=r?function(e,t){if(a(e)&&!s(e,"length").writable)throw new l("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},4751:function(e,t,n){e.exports=n.p+"static/img/menu1-selected.7d37f964.png"},6837:function(e){var t=TypeError,n=9007199254740991;e.exports=function(e){if(e>n)throw t("Maximum allowed index exceeded");return e}},7062:function(e,t,n){e.exports=n.p+"static/img/menu2.e8fedcb5.png"}}]);